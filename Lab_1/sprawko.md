# Przygotowanie środowiska do Analizy Malware

## Instalacja Systemu Windows 10

![Creating Windows VM](img/1.png)

Dla systemu windows należy przeznaczyć conajmniej 60 GB miejsca na dysku  
Ja przeznaczyłem:

- 80 GB miejsca na dysku
- 8 GB pamięci RAM
- 6 wątków procesora

Następnie należy przejść przez proces instalacji

Po udanej instalacji mamy gotowy system Windows 10

![Zainstalowany system](img/2.png)

## Instalacja Flare VM

Zanim zainstaluje się środowisko Flare VM, należy przejść przez kilka kroków  

### Wyłączenie Windows Update

Windows Update można wyłączyć na 2 sposoby

- Group Policy Edit (Wymagany Windows Pro)
- Windows Registry

Ja miałem problem z użyciem GPE, dlatego dodałem klucz do rejestru za pomocą [poradnika](https://www.windowscentral.com/how-stop-updates-installing-automatically-windows-10)

![Windows Update wyłączony za pomocą rejestru](img/3.png)

### Wyłączenie Tamper Protection

![Wyłączony Tamper Protection](img/4.png)

### Wyłaczenie Windows Defender

Ostatnim krokiem przed instalacją Flare VM jest wyłączenie Windows Defendera

Posłużyłem się do tego [skryptem](https://github.com/jeremybeaume/tools/blob/master/disable-defender.ps1), który automatycznie go wyłącza

![Proces wyłączania Windows Defender](img/5.png)

Skrypt potrzebuje 5 cykli restartowania, aby wyłączyć winodows defender całkowicie

![Kolejny restart skryptu](img/6.png)

Skrypt powinien bez problemów wyłączyć Windows Defender

### Flare VM

Aby zainstalować Flare VM, sklonowalem repo, wykonałem polecenia z instrukcji instalacji, a następnie włączyłem skrypt

![Skrypt instalacyjny Flare VM](img/7.png)

Skrypt upewnia się, że zrobiliśmy migawkę (snapshota) przed instalacją

![Migawki](img/8.png)

Skrypt instaluje teraz Boxstartera oraz Chocolatey

![Instalacja Boxstartera i Chocolatey](img/9.png)

Okienko z wyborem narzędzi do zainstalowania

![GUI](img/10.png)

Po wyborze narzędzi została przeprowadzona instalacja narzędzi, która potrwała kilkadziesiąt minut

Po instalacji tak powinno wyglądać gotowe środowisko

![Gotowe Flare VM](img/11.png)

## Pozostałe kroki

### Ghidra

Programu Ghidra nie trzeba pobierać, ponieważ został już zainstalowany wraz z Flare VM

![Próba Ghidry](img/12.png)

### Izolacja Maszyny

Aby malware nie miał dostępu do Hosta należy go od niego jak najbardziej odseparować

![Wyłączenie wspólnego schowka](img/13.png)

![Izolacja karty sieciowej](img/14.png)

## Windows XP

Na potrzeby labów 3+ zainstalowałem również [Windows XP](https://archive.org/details/Windows_XP_Professional_x64.iso)

Do aktywacji użyłem klucza  
B2RBK-7KPT9-4JP6X-QQFWM-PJD6G  
*Klucz działa dla każdej instalacji Windowsa XP*

![Windows XP](img/15.png)

## Podsumowanie

- Windows Defender wyłączony

- Maszyna FlareVM do analizy malware została zainstalowana bez problemów
  
- Maszyna jest odizolowana od sieci oraz systemu Hosta

- Potrzebne narzędzia zostały zainstalowane

- Windows XP zainstalowany
